---
title: 网络请求
categories:
    - CS
abbrlink: 62d10724
---

# URL语法
URL提供了一种定位因特网上任意资源的手段，但这些资源是可以通过各种不同的方案（比如`HTTP`、`FTP`、`SMTP`）来访问饿，因此URL语法会随方案的不同而有所不同。大部分URL都遵循通用的URL语法，而且不同URL方案的风格和语法都有不少重叠，大部分URL方案的语法都建立在下面这个有9部分构成的通用格式上

```python
<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
```

{% note info %}
- `scheme`：使用哪种协议
- `user`：用户名
- `password`：密码
- `host`：域名或ip
- `port`：端口
- `path`：服务器上资源的本地名，由一个斜杠（`/`）将其与前面的URL组件分隔开来。路径组件的语法是与服务器和`scheme`有关的，路径可以分为若干个段，每段都可以有其特有的组件（`params`）
- `params`：某些`scheme`会用这个组件来指定输入参数。参数为名值对儿。URL中可以包含多个参数字段，它们相互之间以及与`path`的其余部分之间用分号（`;`）分隔
- `query`：某些`scheme`会用这个组件传递数据以激活应用程序，多个`query`之间使用`&`分隔
- `frag`：一小片或一部分资源的名字。引用对象时，不会将`frag`字段传送给服务器，这个字段是在客户端内部使用的。
{% endnote %}

下面使用例子直观的演示以下各种方案对应的语法

```python
# 主机与端口
http://www.joes-hardware.com:80/index.html

# 用户名和密码
ftp://anonymous:my_password@ftp.prep.ai.mit.edu/pub/gnu

# 路径
http://www.joes-hardware.com:80/seasonal/index-fall.html

# 参数
# hammers路径的参数为sale=false和show=true
# index.html路径的参数为graphics=true
ttp://www.joes-hardware.com/hammers;sale=false;show=true/index.html;graphics=true

# 查询字符串
http://www.joes-hardware.com/inventory-check.cgi?item=12731&color=blue&size=large

# 片段
http://www.joes-hardware.com/tools.html#drills
```

# HTTP报文

HTTP报文由三个部分组成：对报文进行描述的**起始行**、包含属性的**首部**，以及可选的、包含数据的**主体**

起始行和首部就是由行分隔的ASCII文本。每行都以一个由两个字符组成的行终止序列作为结束，其中包括一个回车符（ASCII码13）和一个换行符（ASCII码10）

主体是一个可选的数据块，与起始行和首部不同的是，主体中可以包含文本或二进制数据，也可以为空

## 报文格式

```python
# 请求报文格式
<method> <request-URL> <version>
<headers>

<entity-body>

# ===========我是分界线===============

# 响应报文格式
<version> <status> <reason-phrase>
<headers>

<entity-body>
```

```python
# 请求报文
GET /test/hi-there.txt HTTP/1.1
Accept: text/*
Host: www.joes-hardware.com

Hi! I am a message!

# ===========我是分界线===============

# 响应报文
HTTP/1.0 200 OK
Content-type: text.plain
Content-length: 19

Hi! I am a message!
```

## 请求方法

{% note info %}
HTTP常用的请求方法：
- `GET`：从服务器获取一份文档
- `HEAD`：只从服务器获取文档的首部
- `POST`：向服务器发送需要处理的数据
- `PUT`：将请求的主体部分存储在服务器上
- `TRACE`：对可能经过代理服务器传送到服务器上去的报文进行追踪
- `OPTIONS`：决定可以在服务器上执行哪些方法
- `DELETE`：从服务器上删除一份文档
{% endnote %}

## 响应状态码

状态码分类如下面表格所示：

| 整体范围 | 已定义范围 | 分类 |
| ------- | -------- | ---- |
| 100～199 | 100～101 | 信息提示 |
| 200～299 | 200～206 |  成功  |
| 300～399 | 300～305 | 重定向 |
| 400～499 | 400～415 | 客户端错误 |
| 500～599 | 500～505 | 服务器错误 |

{% note info %}
常用状态码：
- `100`：说明收到了请求的初始部分，请客户端继续。发送了这个状态码之后，服务器在收到请求之后必须进行响应
- `101`：说明服务器正在根据客户端的指定进行协议切换

---
- `200`：请求没问题，响应的主体部分包含了所请求的资源
- `201`：请求成功并且服务器创建了新的资源
- `202`：服务器已接受请求，但尚未处理
- `203`：服务器已成功处理了请求，但返回的信息不是来自于缘端服务器，而是来自资源的一份副本
- `204`：服务器成功处理了请求，但没有返回任何内容
- `205`：服务器成功处理了请求，并告知浏览器清楚当前页面中的所有HTML表单元素
- `206`：服务器成功处理了一部分请求

---
- `300`：客户端请求一个实际指向多个资源的URL时会返回这个状态码
- `301`：请求的URL已被移除，响应的`Location`首部中应该包含资源现在所处的URL
- `302`：与`301`类似，但是，客户端应该使用`Location`首部给出的URL来临时定位资源，将来的请求仍应使用老的URL
- `303`：告知客户端应该用另一个URL来获取资源
- `304`：客户端可以通过所包含的请求首部，使其请求变成有条件的
- `305`：用户说明必须通过一个代理来访问资源，代理的位置由`Location`首部给出
- `306`：无
- `307`：临时重定向

---
- `400`：用于告知客户端它发送了一个错误的请求
- `401`：与适当的首部一同返回，在这些首部中请求客户端在获取对资源的访问权之前，对自己进行认证
- `402`：无
- `403`：请求被服务器拒绝了
- `404`：服务器无法找到所请求的URL
- `405`：发起的请求中带有所请求的URL不支持的方法
- `406`：客户端可以指定参数来说明它们愿意接受什么类型的实体，但是服务器没有与客户端可接受的URL相匹配的资源
- `407`：用于要求对资源进行认证的代理服务器
- `408`：如果客户端完成请求所花的时间太长，服务器可以回送此状态码，并关闭连接
- `409`：请求可能在资源上引发一些冲突
- `410`：与`404`类似，只是服务器曾经拥有过此资源
- `411`：服务器要求在请求报文中包含`Content-Lengh`首部
- `412`：客户端发起了条件请求，且其中有一个条件失败了
- `413`：客户端发送的实体主体部分比服务器能够或者希望处理的要大
- `414`：客户端所发请求中的URL比服务器能够或者希望处理的要长
- `415`：服务器无法理解或无法支持客户端所发送实体的内容类型
- `416`：请求报文所请求的是指定资源的某个范围，但此范围无效或无法满足
- `417`：请求的`Expect`请求首部包含了一个期望，但服务器无法满足此期望

---
- `500`：服务器遇到一个妨碍它为请求提供服务的错误
- `501`：客户端发起的请求超出服务器的能力范围
- `502`：作为代理或网管使用的服务器从请求响应链的下一条链路上收到了一条伪响应
- `503`：用来说明服务器现在无法为请求提供服务，但将来可以
- `504`：与`408`类似，只是这里的响应来自一个网管或代理。它们在等待另一服务器对其请求进行响应时超时了
- `505`：服务器收到的请求使用了它无法或不愿支持的协议版本
{% endnote %}

