---
title: 强制类型转换
categories:
  - JavaScript
  - 《你不知道的JavaScript（中卷）》
abbrlink: 1750eb3e
date: 2019-05-05 13:40:29
---

# 类型转换规则

## 转换为字符串

{% note info %}
- **null**：`"null"`；
- **undefined**：`"undefined"`；
- **布尔值**：`"true"`或`"false"`；
- **数值**：通常直接转换为字符串即可，但是对于极小或极大的数值，会使用指数形式；
- **对象**：返回对象的`toString()`方法的返回值；
- **数组**：将所有单元字符串化以后再用`","`连接起来。
{% endnote %}

```js
console.log(String(null))                       // "null"
console.log(String(undefined))                  // "undefined"
console.log(String(false))                      // "false"
console.log(String(123))                        // "123"
console.log(String(123 * 10000000000000000000)) // "1.23e+21"
console.log(String({a: 1}))                     // "[object Object]"
console.log(String([1, 2, 3]))                  // "1,2,3"
```

## 转换为数值

{% note info %}
- **null**：`0`；
- **undefined**：`NaN`；
- **布尔值**：`0`或`1`；
- **字符串**：十进制数值或`NaN`；
- **对象（包括数组）**：会按如下顺序进行转换
    1. 调用对象自身的`valueOf()`方法。如果返回基本类型的值，则直接将该值转换为数值；
    2. 如果`valueOf()`方法返回的还是对象，则改为调用对象自身的`toString()`方法。如果`toString()`方法返回基本类型的值，则将该值转换为数值；
    3. 如果`toString()`方法返回的是对象，抛出错误。
{% endnote %}

```js
console.log(Number(null))           // 0
console.log(Number(undefined))      // NaN
console.log(Number(false))          // 0
console.log(Number('123'))          // NaN
console.log(Number('123abc'))       // NaN
console.log(Number({a: 1}))         // NaN
console.log(Number([1, 2, 3]))      // NaN

var obj = {
    valueOf () {
        return 42
    }
}

var array = [1, 2, 3]
array.valueOf = function () {
    return 123
}

console.log(Number(obj))            // 42
console.log(Number(array))          // 123
```

## 转换为布尔值

{% note info %}
在将值转换为布尔值时，除了下述5种情况，其他所有情况都会转换为`true`：
- **null**
- **undefined**
- **false**
- **+0、-0或NaN**
- **""**
{% endnote %}

# 显示强制类型转换

{% note info %}
- 一元运算符`+`和`-`会将字符串转换为数值，或将日期对象转换为对应的毫秒数。注意不要混淆`+`、`++`、`+ +`，`-`、`--`、`- -`;
- 一元运算符`~`会先将值强制类型转换为32位数值，然后执行按位非操作，可以将`~x`等价于`-(x+1)`。但是`~-1`的结果是`0`而不是`-0`，因为`~`是字位操作而非数学运算;
- 将值转换为布尔值时，可以使用`!`运算符。
{% endnote %}

```js
var a = '1'
var b = +a
var c = -a
var d = --a
var e = - -a
console.log(b)      // 1
console.log(c)      // -1
console.log(d)      // 1
console.log(e)      // 0

var f = new Date()
console.log(+f)     // 1557055687256

// ==============================

var x = -42
console.log(~x)     // 41

// ==============================

var a = '0'
var b = []
var c = {}
var d = ''
var e = 0
var f = null
var g

console.log(!!a)     // true
console.log(!!b)     // true
console.log(!!c)     // true
console.log(!!d)     // false
console.log(!!e)     // false
console.log(!!f)     // false
console.log(!!g)     // false
```

# 隐式强制类型转换

## + 运算符

`+`运算符既能用于数值加法，也能用于字符串拼接。JavaScript怎样来判断我们要执行的是哪个操作？

{% note info %}
1. 如果操作数中有字符串，进行字符串拼接操作；
2. 如果操作数中有对象（包括数组），首先调用其`valueOf()`方法，然后再对其返回值调用`toString()`方法，最后用转换后的字符串去进行字符串拼接；
3. 其他情况全都进行数值加法。
{% endnote %}

## - 运算符

与`+`运算符不同，`-`运算符会只会执行减法运算。所以它会先将非数值类型的数据转换为字符串（通过`toString()`），然后再转换为数值，最后进行减法运算。

```js
var a = '12'
var b = 1
console.log(a-b)    // 11
```

# 宽松相等和严格相等

首先明确一个概念，**`==`允许在相等比较中进行强制类型转换，而`===`不允许**。

# 抽象关系比较