---
title: 第四章 变量、作用域和内存问题
abbrlink: 9b1cd8c7
date: 2019-03-02 17:18:57
categories:
  - JavaScript
  - 《JavaScript高级程序设计》
---

# 基本类型和引用类型的值

在将一个值赋给变量时，如果这个值是基本类型值，则变量中保存的是这个值本身。如果这个值是引用类型，则变量中保存的只是该值的一个引用（通过引用，可以在内存中找到这个引用类型的值）！

## 复制变量值

```js
// ===================================================
// 在从一个变量向另一个变量复制基本类型值和引用类型值的区别
// ===================================================

//复制基本类型值
var a = 1
var b = a
b = 2
console.log(a, b)   // 1, 2

// 复制引用类型值
// c和d中保存的都是指向内存中同一对象的引用
var c = { num: 1 }
var d = c
d.num = 2
console.log(c.num, d.num)   //2, 2
```

## 传递参数

ECMAScript中所有函数的参数都是按值传递的！

简单来说就是复制一份基本类型值/引用类型值的引用给函数参数。

## 检测类型

前面介绍过用`typeof`操作符来检测数据类型，但是对于一个`对象`或`null`，`typeof`并不能很好的发挥作用，下面简单介绍一下检测数据类型常用的方法：

{% note info %}
- typeof：适用于检测基本数据类型；
- instanceof：用于测试构造函数的prototype属性是否出现在对象的原型链中的任何位置；
- Object.prototype.toString.call()：返回一个表示类型的字符串，详情请看[MDN官网](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString)。
{% endnote %}

书中说：“~~根据规定，所有引用类型的值都是Object的实例。因此，在检测一个引用类型值和Object构造函数时，instanceof操作符始终会返回true。~~”
**时代在发展进步，这个说法变得不准确了，有例外了！！！**

```js
var a = Object.create(null)
console.log(a instanceof Object)    // false
```

# 执行环境及作用域

执行环境由三部分组成：**变量对象**、**作用域链**和**this**。

{% note info %}
- 变量对象：执行环境中定义的所有变量和函数都保存在这个对象中，我们在编程时无法访问这个对象；
- 作用域链：从当前执行环境的变量对象出发，将外层每一个执行环境的变量对象串联起来，保证对当前执行环境有权访问的所有变量和函数的有序访问；
- this：这里先不做介绍。
{% endnote %}

每个函数都有自己的执行环境，在访问一个变量或函数时，首先会在当前环境下的变量对象中查找，如果没有找到就沿着作用域链逐层查找。