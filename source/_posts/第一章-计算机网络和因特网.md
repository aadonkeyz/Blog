---
title: 第一章 计算机网络和因特网
categories:
    - 计算机网络
    - 《计算机网络-自顶向下方法》
abbrlink: 58d1442
mathjax: true
date: 2019-06-27 20:46:06
---


# 什么是因特网

{% note info %}
因特网是一个全世界范围的网络，它是一个互联了遍及全世界的数以亿计的设备的网络。下面介绍因特网中的术语：
- **主机**或**端系统**：接入因特网的设备。
- **通信链路**：数据在因特网中传输是需要介质的吧，这个介质就是通信链路。它包括同轴电缆、铜线、光纤和无线电频谱等。不同的链路能够以不同的速率传输数据，链路的**传输速率**以**比特/秒**度量（bit/s，或bps）。
- **分组交换机**：当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段 ，并为每段加上首部字节。由此形成的信息包用计算机网络的术语来说称为**分组**。**分组交换机**从它的一条入通信链路接收到达的分组，并从它的一条出通信链路转发该分组。在当今的因特网中，两种最著名的交换机是**路由器**和**链路交换机**。链路交换机通常用于接入网中，而路由器通常用于网络核心中。从发送端系统到接收端系统，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的**路径**。
- **网络边缘**：指因特网中的端系统，它们处于因特网的最边缘。
- **网络核心**：是由因特网中的分组交换机和通信链路构成的网状网络。
- **因特网服务提供商（ISP）**：每个ISP是一个由多个分组交换机和多段通信链路组成的网络。
- **网络协议**：一个协议定义了在两个或多个通信实体之间交换的报文格式和次序，以及报文发送和/或接收一条报文或其他事件所采取的动作。
{% endnote %}

# 分组交换

在各种网络应用中，端系统彼此交换**报文**。报文能够包含协议设计者需要的任何东西。为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，称之为**分组**。

## 存储转发

多数分组交换机在链路的输入端使用**存储转发传输**机制。存储转发机制是指在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组。

以下图为例，源有三个大小均为$L$比特（bit）分组需要通过路由器传输到目的地，链路的传输速率为$R$比特/秒（bit/s，或bps）。

{% note info %}
在不考虑其他时延的情况下：
1. 时刻$0$：源开始传输分组1。
2. 时刻$L/R$：源已经传输完分组1，开始传输分组2。路由器刚好接收到完整的分组1，开始将分组1向目的地传输。
3. 时刻$2L/R$：源已经传输完分组2，开始传输分组3。路由器刚好接收到完整的分组2，开始将分组2向目的地传输。目的地刚好接收到完整的分组1。
4. 时刻$3L/R$：源已经传输完分组3。路由器刚好接收到完整的分组3，开始将分组3向目的地传输。目的地刚好接收到完整的分组2。
5. 时刻$4L/R$：目的地刚好接收到完整的分组3。
{% endnote %}

![存储转发传输](https://blog-images-1258719270.cos.ap-shanghai.myqcloud.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/%E5%AD%98%E5%82%A8%E8%BD%AC%E5%8F%91%E4%BC%A0%E8%BE%93.png)

## 输出缓存和丢包

每个分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机具有一个**输出缓存**（也称为**输出队列**），它用于存储路由器准备发往那条链路的分组。如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须在该输出缓存中等待。

因为缓存空间的大小是有限的，一个到达的分组可能发现该缓存已被其他等待传输的分组完全充满了。在此情况下，将出现**分组丢失（丢包）**，到达的分组或已排队的分组之一将被丢弃。

## 转发表

路由器从与它相连的一条通信链路得到分组，将其向与它相连的另一条通信链路转发。但是该路由器怎样决定它应当向哪条链路进行转发呢？不同的计算机网络实际上是以不同的方式完成的。这里，我们简要介绍在因特网中所采用的方法。

在因特网中，每个端系统具有一个称为IP地址的地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。如同邮政地址那样，该地址具有一种等级结构。每台路由器都具有一个**转发表**，用于将目的地址（或目的地址的一部分）映射成为输出链路。当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发现适当的出链路，然后路由器将该分组导向该出链路。

## 时延概述

{% note info %}
当分组从一个结点沿着这条路径到后续结点，该分组在沿途的每个结点经受了几种不同类型的时延，分别是：
- **处理时延**：检查分组首部和决定将该分组导向何处所需要的时间。
- **排队时延**：分组在输出缓存中排队等待的时间。
- **传输时延**：传输整个分组所需时间。如一个分组为$L$比特，传输速率为$R$比特/秒，则传输时延为$L/R$秒。
- **发送时延**：端系统或路由器发送一个完整的分组所需时间，即端系统或路由器内部的传输时延。
- **传播时延**：传输单个比特所需时间。如两个结点之间距离为$d$米，它们之间链路的传播速率为$v$米/秒，则传播时延为$d/v$。
- **节点总时延**：处理时延+排队时延+发送时延+传播时延。

**仔细区分传输时延和传播时延，传输速率和传播速率的概念。**
{% endnote %}

# 电路交换

通过网络链路和交换机移动数据有两种基本方法：电路交换和分组交换。

在电路交换网络中，在端系统间通信会话期间，预留了端系统间通信沿路径所需要的资源（缓存，链路传输速率）。在分组交换网络中，这些资源则是不预留的。会话的报文按需使用这些资源，其后果可能是不得不等待（即排队）接入通信线路。

传统的电话网络是电路交换网络的例子。考虑当一个人通过电话网向另一个人发送信息时所发生的情况。在发送发能够发送信息之前，该网络必须在发送方和接收方之间建立一条连接。这是一个名副其实的连接，因为此时沿着发送方和接收方之间路径上的交换机都将为该连接维护连接状态。用电话的术语来说，该连接被称为一条电路。当网络创建这种电路时，它也在连接期间在该网络链路上预留了恒定的传输速率（表示为每条链路传输容量的一部分）。既然已经为该发送方-接收方连接预留了带宽，则发送方能够以确保的恒定速率向接收方传送数据。

链路中的电路是通过**频分复用（FDM）**和**时分复用（TDM）**来实现的，这里暂时不详细介绍了。

相对于电路交换，分组交换是按需分配链路使用的，更有优势。

# 五层因特网协议栈

![五层因特网协议栈](https://blog-images-1258719270.cos.ap-shanghai.myqcloud.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/%E4%BA%94%E5%B1%82%E5%9B%A0%E7%89%B9%E7%BD%91%E5%8D%8F%E8%AE%AE%E6%A0%88.png)

{% note info %}
应用层是网络应用程序及它们的应用层协议存留的地方。因特网的应用层包括许多协议，例如HTTP、SMTP、FTP等。我们将看到，某些网络功能，如将像www.ietf.org这样对人友好的端系统名字转换为32比特网络地址，也是借助于特定的应用层协议即域名系统（DNS）完成的。

应用层协议分布在多个端系统上，一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息的分组。我们把这种位于应用层的信息分组称为**报文**。

---
因特网的运输层在应用程序端点之间传送应用层报文。在因特网中，有两个运输协议，即TCP和UDP，利用其中的任意一个都能运输应用层报文。我们把运输层分组称为**报文段**。

---
因特网的网络层负责将称为**数据报**的网络层分组从一台主机移动到另一台主机。在一台源主机中的因特网运输层协议向网络层递交运输层报文段和目的地址，就像你通过邮政服务寄信件时提供一个目的地址一样。

因特网的网络层包括著名的IP协议，该协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。仅有一个IP协议，所有具有网络层的因特网组件必须运行IP协议。因特网的网络层也包括决定路由的路由选择协议，它使得数据报根据该路由从源传输到目的地。在一个网络中，其网络管理者能够运行所希望的任何路由选择协议。

尽管网络层包括了IP协议和一些路由选择协议，但通常把它简单地成为IP层，这反映了IP是将因特网连接在一起的粘合剂这样的事实

---
为了将分组从一个结点（主机或路由器）移动到路径上的下一个结点，网络层必须依靠该链路层的服务。特别是在每个结点，网络层将数据报下传给链路层，链路层沿着路径将数据报传递给下一个结点。在下一个结点，链路层将数据上传给网络层。

由链路层提供的服务取决于应用于该链路的特定链路层协议。例如，某些协议基于链路提供可靠传递，从传输结点跨越一条链路到接收结点。值得注意的是，这种可靠的传递服务不同于TCP的可靠传递服务，TCP提供从一个端系统到另一个端系统的可靠交付。链路层的例子包括以太网、WiFi和电缆接入网的DOCSOS协议。

因为数据报从源到目的地传送通常需要经过几条链路，一个数据报可能被沿途不同链路上的不同链路层协议处理。例如，一个数据报可能被一段链路上的以太网和下一段链路上的PPP多处理。网络层将受到来自每个不同的链路层协议的不同服务。

我们把链路层分组称为**帧**。

---
物理层的任务是将帧中的一个一个比特从一个结点移动到下一个结点。
{% endnote %}

![例子](https://blog-images-1258719270.cos.ap-shanghai.myqcloud.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/%E4%BE%8B%E5%AD%90.png)

